<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Binary">
    <title>Binary</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNjg2ZqtsUmoXcMq-guhJAPwY9lIUNPkI&libraries=places" async defer></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="root"></div>
    
<script type="text/babel">
const { useState, useEffect } = React;

// === Firebase Configuration ===
// TODO: Replace with your Firebase project credentials from Firebase Console
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

// Initialize Firebase
let auth, db;
try {
  firebase.initializeApp(firebaseConfig);
  auth = firebase.auth();
  db = firebase.firestore();
} catch (error) {
  console.error("Firebase initialization error:", error);
}

// === SVG icons ===
const ThumbsUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>;
const ThumbsDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></svg>;
const Filter = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>;
const MessageSquare = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>;
const Trash2 = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
const Users = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
const LogOut = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>;
const Globe = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>;
const Lock = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;

// === Master category list ===
const ALL_CATEGORIES = [
  'Food', 'Coffee', 'Beverages', 'Places', 'Books', 'Movies',
  'Cheese', 'Dates', 'People', 'Sports', 'Entertainment', 'Things', 'Other'
];

// Cache for category detection
let categoryCache = {};
try {
  const storedCache = localStorage.getItem("categoryCache");
  if (storedCache) categoryCache = JSON.parse(storedCache);
} catch(err){ console.warn(err); }

function saveCache() {
  try { localStorage.setItem("categoryCache", JSON.stringify(categoryCache)); }
  catch(err){ console.warn(err); }
}

// Enhanced keyword patterns with specificity
const CATEGORY_KEYWORDS = {
  Cheese: {
    exact: ["cheese","cheddar","brie","gouda","mozzarella","parmesan","feta","camembert","gruyere","manchego","pecorino","ricotta","stilton","roquefort","gorgonzola","emmental","havarti","provolone"],
    score: 0.8
  },
  Coffee: {
    exact: ["coffee","cafe","latte","espresso","cappuccino","americano","macchiato","mocha","flat white","cortado","affogato"],
    partial: ["starbucks","costa","cafe nero","pret"],
    score: 0.7
  },
  Beverages: {
    exact: ["bar","pub","cocktail","brewery","beer","wine","gin","vodka","whiskey","rum","tequila","ale","lager","cider","spirits","champagne","prosecco"],
    partial: ["taproom","brewpub","tavern","lounge"],
    score: 0.7
  },
  Food: {
    exact: ["restaurant","ramen","pizza","burger","pasta","sushi","taco","curry","noodles","sandwich","steak","chicken","seafood","bakery","diner","bistro"],
    partial: ["cuisine","eatery","grill","kitchen"],
    score: 0.6
  },
  Places: {
    exact: ["museum","park","beach","monument","gallery","plaza","square","garden","island","mountain","lake","resort","castle","palace","temple","cathedral"],
    partial: ["tourist","attraction","landmark","historic"],
    score: 0.5
  },
  Books: {
    exact: ["novel","memoir","biography","poetry","textbook"],
    partial: ["author","reading","literature"],
    score: 0.6
  },
  Movies: {
    exact: ["film","cinema","documentary","series","episode"],
    partial: ["actor","director","netflix","disney"],
    score: 0.5
  },
  Things: {
    exact: ["shoes","bike","sneakers","jacket","laptop","bag","phone","watch","headphones","camera","tablet","keyboard","backpack","suitcase","umbrella"],
    score: 0.6
  },
  Sports: {
    exact: ["football","soccer","basketball","tennis","cricket","rugby","baseball","hockey","golf","swimming","match","championship","tournament","surfing","skiing","snowboarding","skateboarding","climbing","hiking","running","cycling","yoga","pilates","boxing","wrestling","martial arts","karate","judo","gymnastics","athletics","track","field"],
    score: 0.7
  },
  Dates: {
    exact: ["date","dating","romantic","anniversary","valentine","proposal","engagement","wedding","relationship","boyfriend","girlfriend","partner","spouse"],
    score: 0.7
  },
  People: {
    exact: ["person","friend","colleague","coworker","manager","boss","teacher","professor","doctor","nurse","artist","musician","celebrity","politician","athlete","neighbor","roommate","classmate"],
    score: 0.6
  },
  Entertainment: {
    exact: ["concert","festival","show","performance","theater","theatre","comedy","stand-up","magic","circus","exhibition","gig","club","nightclub","disco","rave","party","event"],
    score: 0.6
  }
};

// Helper: wait for Google Maps API
function waitForGoogleMaps() {
  return new Promise(resolve => {
    if (window.google && window.google.maps) return resolve();
    const interval = setInterval(() => {
      if (window.google && window.google.maps) {
        clearInterval(interval);
        resolve();
      }
    }, 100);
  });
}

// Helper: compute distance in km
function distanceKm(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

// === Smart category detection ===
async function detectCategory(inputText, userLat, userLng) {
  const text = inputText.trim();
  if (!text) return 'Other';

  const lower = text.toLowerCase();
  
  // Check cache first
  if (categoryCache[text]) return categoryCache[text];

  // Initialize scores
  const scores = {};
  ALL_CATEGORIES.forEach(cat => scores[cat] = 0);

  // 1Ô∏è‚É£ Keyword matching
  for (const [category, config] of Object.entries(CATEGORY_KEYWORDS)) {
    if (config.exact?.some(k => lower.includes(k))) {
      scores[category] = Math.max(scores[category], config.score);
    }
    if (config.partial?.some(k => lower.includes(k))) {
      scores[category] = Math.max(scores[category], config.score * 0.7);
    }
  }

  // 2Ô∏è‚É£ Google Books API
  try {
    const bookRes = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(text)}&maxResults=5`);
    const bookData = await bookRes.json();
    
    if (bookData.items?.length) {
      const bestMatch = bookData.items[0];
      const title = bestMatch.volumeInfo.title?.toLowerCase() || '';
      const titleMatch = title === lower || title.includes(lower);
      
      const ratingCount = bestMatch.volumeInfo.ratingsCount || 0;
      const avgRating = bestMatch.volumeInfo.averageRating || 0;
      const popularity = Math.min((ratingCount / 100) * avgRating, 10) / 10;
      
      if (titleMatch) {
        scores.Books = Math.max(scores.Books, 0.7 + (popularity * 0.2));
      } else if (bookData.items.length >= 3) {
        scores.Books = Math.max(scores.Books, 0.4 + (popularity * 0.1));
      }
    }
  } catch(err){ console.warn("Books API failed:", err); }

  // 3Ô∏è‚É£ TMDB Movies API
  try {
    const tmdbKey = '559458ec6b7148bf5d8a39f7224a2fb8';
    const movieRes = await fetch(
      `https://api.themoviedb.org/3/search/movie?api_key=${tmdbKey}&query=${encodeURIComponent(text)}`
    );
    const movieData = await movieRes.json();
    
    if (movieData.results?.length) {
      const bestMatch = movieData.results[0];
      const title = bestMatch.title?.toLowerCase() || '';
      const titleMatch = title === lower || title.includes(lower);
      
      const popularity = Math.min(bestMatch.popularity / 100, 1);
      
      if (titleMatch) {
        scores.Movies = Math.max(scores.Movies, 0.6 + (popularity * 0.2));
      } else if (movieData.results.length >= 3) {
        scores.Movies = Math.max(scores.Movies, 0.35 + (popularity * 0.1));
      }
    }
  } catch(err){ console.warn("Movies API failed:", err); }

  // 4Ô∏è‚É£ Google Places API
  try {
    await waitForGoogleMaps();
    if (window.google?.maps) {
      const service = new google.maps.places.AutocompleteService();

      const predictions = await new Promise(resolve => {
        service.getPlacePredictions({ input: text }, (preds, status) => {
          resolve(status === google.maps.places.PlacesServiceStatus.OK ? preds?.slice(0, 3) : []);
        });
      });

      if (predictions?.length) {
        const detailsService = new google.maps.places.PlacesService(document.createElement('div'));
        
        const placeResults = await Promise.all(predictions.map(p => new Promise(res => {
          detailsService.getDetails({ 
            placeId: p.place_id, 
            fields: ['types', 'geometry', 'user_ratings_total', 'rating', 'name']
          }, place => res(place));
        })));

        for (const place of placeResults) {
          if (!place?.types) continue;

          let distance = Infinity;
          let proximityBoost = 0;
          
          const isMajorPlace = place.types.some(t => 
            ['locality', 'country', 'administrative_area_level_1', 'natural_feature', 
             'continent', 'archipelago', 'colloquial_area'].includes(t)
          );
          
          if (userLat && userLng && place.geometry?.location) {
            distance = distanceKm(userLat, userLng, place.geometry.location.lat(), place.geometry.location.lng());
            
            if (!isMajorPlace) {
              if (distance < 1) proximityBoost = 0.5;
              else if (distance < 5) proximityBoost = 0.3;
              else if (distance < 20) proximityBoost = 0.15;
            }
          }

          const reviewCount = place.user_ratings_total || 0;
          const avgRating = place.rating || 0;
          const popularity = Math.min((reviewCount / 500) * (avgRating / 5), 1);
          const nameMatch = place.name?.toLowerCase().includes(lower) ? 0.2 : 0;

          const typeMap = {
            cafe: { cat: 'Coffee', base: 0.7 },
            bar: { cat: 'Beverages', base: 0.7 },
            night_club: { cat: 'Beverages', base: 0.7 },
            restaurant: { cat: 'Food', base: 0.65 },
            meal_takeaway: { cat: 'Food', base: 0.6 },
            food: { cat: 'Food', base: 0.6 },
            museum: { cat: 'Places', base: 0.7 },
            park: { cat: 'Places', base: 0.7 },
            tourist_attraction: { cat: 'Places', base: 0.7 },
            natural_feature: { cat: 'Places', base: 0.75 },
            locality: { cat: 'Places', base: 0.8 },
            country: { cat: 'Places', base: 0.85 },
            administrative_area_level_1: { cat: 'Places', base: 0.75 },
            continent: { cat: 'Places', base: 0.85 },
            archipelago: { cat: 'Places', base: 0.75 },
            colloquial_area: { cat: 'Places', base: 0.7 }
          };

          for (const type of place.types) {
            const mapping = typeMap[type];
            if (mapping) {
              const score = mapping.base + proximityBoost + (popularity * 0.1) + nameMatch;
              scores[mapping.cat] = Math.max(scores[mapping.cat], score);
            }
          }
        }
      }
    }
  } catch(err){ console.warn("Places detection failed:", err); }

  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  let [bestCat, bestScore] = sorted[0];
  
  if (bestScore < 0.3) bestCat = 'Other';

  categoryCache[text] = bestCat;
  saveCache();

  return bestCat;
}

// === Main App ===
function BinaryApp() {
  const [user, setUser] = useState(null);
  const [items, setItems] = useState([]);
  const [inputText, setInputText] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [isLoading, setIsLoading] = useState(true);
  const [editingComment, setEditingComment] = useState(null);
  const [commentText, setCommentText] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [view, setView] = useState('my'); // 'my' or 'public'
  const [publicItems, setPublicItems] = useState([]);
  const [message, setMessage] = useState(null);

  // Auth state listener
  useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged(async (user) => {
      setUser(user);
      if (user) {
        await loadUserItems(user.uid);
        await migrateLocalStorageData(user.uid);
      }
      setIsLoading(false);
    });

    // Get user location
    navigator.geolocation.getCurrentPosition(
      pos => { window.userLat = pos.coords.latitude; window.userLng = pos.coords.longitude; },
      err => console.warn('Location denied:', err)
    );

    return () => unsubscribe();
  }, []);

  // Load public items when switching to public view
  useEffect(() => {
    if (view === 'public') {
      loadPublicItems();
    }
  }, [view]);

  const showMessage = (text, type = 'success') => {
    setMessage({ text, type });
    setTimeout(() => setMessage(null), 3000);
  };

  // Migrate localStorage data to Firestore
  const migrateLocalStorageData = async (userId) => {
    try {
      const stored = localStorage.getItem('binaryItems');
      if (!stored) return;

      const localItems = JSON.parse(stored);
      if (localItems.length === 0) return;

      // Check if user already has items
      const snapshot = await db.collection('items').where('userId', '==', userId).limit(1).get();
      if (!snapshot.empty) {
        // User already has data, don't migrate
        localStorage.removeItem('binaryItems');
        return;
      }

      // Migrate items
      const batch = db.batch();
      localItems.forEach(item => {
        const docRef = db.collection('items').doc();
        batch.set(docRef, {
          ...item,
          userId,
          isPublic: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      });

      await batch.commit();
      localStorage.removeItem('binaryItems');
      showMessage('Your previous items have been migrated to your account!');
    } catch (error) {
      console.error('Migration error:', error);
    }
  };

  // Load user's items
  const loadUserItems = async (userId) => {
    try {
      const snapshot = await db.collection('items')
        .where('userId', '==', userId)
        .orderBy('timestamp', 'desc')
        .get();
      
      const loadedItems = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      setItems(loadedItems);
    } catch (error) {
      console.error('Error loading items:', error);
    }
  };

  // Load public items
  const loadPublicItems = async () => {
    try {
      const snapshot = await db.collection('items')
        .where('isPublic', '==', true)
        .orderBy('timestamp', 'desc')
        .limit(50)
        .get();
      
      const loadedItems = await Promise.all(snapshot.docs.map(async doc => {
        const itemData = doc.data();
        // Get user info
        const userDoc = await db.collection('users').doc(itemData.userId).get();
        const userData = userDoc.data();
        
        return {
          id: doc.id,
          ...itemData,
          userName: userData?.displayName || 'Anonymous'
        };
      }));
      setPublicItems(loadedItems);
    } catch (error) {
      console.error('Error loading public items:', error);
    }
  };

  // Sign in with Google
  const signInWithGoogle = async () => {
    try {
      const provider = new firebase.auth.GoogleAuthProvider();
      const result = await auth.signInWithPopup(provider);
      
      // Create/update user document
      await db.collection('users').doc(result.user.uid).set({
        displayName: result.user.displayName,
        email: result.user.email,
        photoURL: result.user.photoURL,
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

      showMessage('Welcome back!');
    } catch (error) {
      console.error('Sign in error:', error);
      showMessage('Failed to sign in. Please try again.', 'error');
    }
  };

  // Sign out
  const signOut = async () => {
    try {
      await auth.signOut();
      setItems([]);
      setPublicItems([]);
      setView('my');
      showMessage('Signed out successfully');
    } catch (error) {
      console.error('Sign out error:', error);
    }
  };

  // Add item
  const addItem = async (rating) => {
    if (!inputText.trim() || isProcessing || !user) return;
    
    setIsProcessing(true);
    try {
      const category = await detectCategory(inputText, window.userLat, window.userLng);
      const newItem = {
        text: inputText.trim(),
        rating,
        category,
        timestamp: Date.now(),
        date: new Date().toLocaleDateString(),
        userId: user.uid,
        isPublic: true
      };

      const docRef = await db.collection('items').add({
        ...newItem,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      setItems([{ id: docRef.id, ...newItem }, ...items]);
      setInputText('');
      showMessage('Item added!');
    } catch (err) {
      console.error('Failed to add item:', err);
      showMessage('Failed to add item. Please try again.', 'error');
    } finally {
      setIsProcessing(false);
    }
  };

  // Update category
  const updateCategory = async (id, newCat) => {
    try {
      await db.collection('items').doc(id).update({ category: newCat });
      setItems(items.map(item => item.id === id ? { ...item, category: newCat } : item));
    } catch (error) {
      console.error('Error updating category:', error);
    }
  };

  // Toggle public/private
  const togglePublic = async (id, currentStatus) => {
    try {
      await db.collection('items').doc(id).update({ isPublic: !currentStatus });
      setItems(items.map(item => item.id === id ? { ...item, isPublic: !currentStatus } : item));
      showMessage(currentStatus ? 'Item is now private' : 'Item is now public');
    } catch (error) {
      console.error('Error toggling public status:', error);
    }
  };

  // Delete item
  const deleteItem = async (id) => {
    try {
      await db.collection('items').doc(id).delete();
      setItems(items.filter(item => item.id !== id));
      showMessage('Item deleted');
    } catch (error) {
      console.error('Error deleting item:', error);
    }
  };

  // Comment functions
  const startEditingComment = (item) => { 
    setEditingComment(item.id); 
    setCommentText(item.comment || ''); 
  };

  const saveComment = async (id) => {
    try {
      await db.collection('items').doc(id).update({ comment: commentText.trim() });
      setItems(items.map(i => i.id === id ? { ...i, comment: commentText.trim() } : i));
      setEditingComment(null);
      setCommentText('');
    } catch (error) {
      console.error('Error saving comment:', error);
    }
  };

  const cancelEditingComment = () => { 
    setEditingComment(null); 
    setCommentText(''); 
  };

  const categories = ['All', ...ALL_CATEGORIES];
  const currentItems = view === 'my' ? items : publicItems;
  const filteredItems = selectedCategory === 'All' ? currentItems : currentItems.filter(i => i.category === selectedCategory);
  const getRatingEmoji = (rating) => rating === 'like' ? 'üëç' : 'üëé';
  const getRatingColor = (rating) => rating === 'like' ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300';

  // Login screen
  if (!user) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center px-4">
        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">
          <h1 className="text-4xl font-bold text-gray-800 mb-2">Binary</h1>
          <p className="text-gray-600 mb-8">Yes/no, that's all</p>
          
          <div className="mb-8">
            <div className="text-6xl mb-4">üëç üëé</div>
            <p className="text-gray-600">Track what you love and hate. Share with friends.</p>
          </div>

          <button
            onClick={signInWithGoogle}
            className="w-full bg-white border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-semibold py-3 px-6 rounded-xl flex items-center justify-center gap-3 transition-colors"
          >
            <svg className="w-5 h-5" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Sign in with Google
          </button>

          <p className="mt-6 text-sm text-gray-500">
            Your data is private by default. Choose what to share.
          </p>
        </div>
      </div>
    );
  }

  if (isLoading) {
    return <div className="min-h-screen flex items-center justify-center text-gray-600">Loading...</div>;
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 pb-6">
      <div className="max-w-2xl mx-auto px-4 py-6">

        {/* Message notification */}
        {message && (
          <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${
            message.type === 'error' ? 'bg-red-500' : 'bg-green-500'
          } text-white font-medium animate-fade-in`}>
            {message.text}
          </div>
        )}

        {/* Header */}
        <div className="text-center mb-6">
          <div className="flex items-center justify-between mb-2">
            <div></div>
            <h1 className="text-3xl font-bold text-gray-800">Binary</h1>
            <button
              onClick={signOut}
              className="p-2 text-gray-600 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
              title="Sign out"
            >
              <LogOut />
            </button>
          </div>
          <p className="text-gray-600">Welcome, {user.displayName}!</p>
        </div>

        {/* View Toggle */}
        <div className="bg-white rounded-2xl shadow-lg p-4 mb-6">
          <div className="flex gap-2">
            <button
              onClick={() => setView('my')}
              className={`flex-1 py-3 px-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2 ${
                view === 'my' 
                  ? 'bg-purple-500 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <Lock />
              My Items ({items.length})
            </button>
            <button
              onClick={() => setView('public')}
              className={`flex-1 py-3 px-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2 ${
                view === 'public' 
                  ? 'bg-purple-500 text-white' 
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              <Globe />
              Public Feed
            </button>
          </div>
        </div>

        {/* Input (only show in 'my' view) */}
        {view === 'my' && (
          <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
            <div className="flex items-center gap-2 mb-4">
              <div className="relative flex-1">
                <input
                  type="text"
                  value={inputText}
                  onChange={(e) => setInputText(e.target.value)}
                  placeholder="What did you experience?"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none"
                  onKeyPress={(e) => e.key === 'Enter' && inputText.trim() && !isProcessing && document.getElementById('like-btn').focus()}
                  disabled={isProcessing}
                />
              </div>
            </div>

            <div className="text-xs text-gray-500 mb-3 text-center">
              Tap the microphone icon on your keyboard to use voice input
            </div>

            <div className="flex gap-3">
              <button
                id="like-btn"
                onClick={() => addItem('like')}
                disabled={!inputText.trim() || isProcessing}
                className="flex-1 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-semibold py-3 px-6 rounded-xl flex items-center justify-center gap-2 transition-colors"
              >
                <ThumbsUp />
                {isProcessing ? 'Processing...' : 'Like'}
              </button>
              <button
                onClick={() => addItem('dislike')}
                disabled={!inputText.trim() || isProcessing}
                className="flex-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-semibold py-3 px-6 rounded-xl flex items-center justify-center gap-2 transition-colors"
              >
                <ThumbsDown />
                {isProcessing ? 'Processing...' : 'Dislike'}
              </button>
            </div>
          </div>
        )}

        {/* Filter */}
        {currentItems.length > 0 && (
          <div className="bg-white rounded-2xl shadow-lg p-4 mb-6">
            <div className="flex items-center gap-2 mb-3">
              <Filter />
              <span className="font-semibold text-gray-700">Filter by category:</span>
            </div>
            <div className="flex flex-wrap gap-2">
              {categories.map(cat => (
                <button
                  key={cat}
                  onClick={() => setSelectedCategory(cat)}
                  className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                    selectedCategory === cat 
                      ? 'bg-purple-500 text-white' 
                      : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                  }`}
                >
                  {cat}
                </button>
              ))}
            </div>
          </div>
        )}

        {/* Items List */}
        <div className="space-y-3">
          {filteredItems.length === 0 ? (
            <div className="bg-white rounded-2xl shadow-lg p-12 text-center">
              <div className="text-6xl mb-4">{view === 'public' ? 'üåç' : 'üìù'}</div>
              <p className="text-gray-500">
                {view === 'public' 
                  ? 'No public items yet. Start sharing your ratings!' 
                  : currentItems.length === 0 
                    ? "No ratings yet. Start tracking!" 
                    : "No items in this category yet."}
              </p>
            </div>
          ) : (
            filteredItems.map(item => (
              <div key={item.id} className="bg-white rounded-xl shadow-md p-4 hover:shadow-lg transition-shadow">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1 flex-wrap">
                      <span className={`px-3 py-1 rounded-full text-sm font-semibold border-2 ${getRatingColor(item.rating)}`}>
                        {getRatingEmoji(item.rating)} {item.rating === 'like' ? 'Liked' : 'Disliked'}
                      </span>

                      {view === 'my' ? (
                        <select
                          value={item.category}
                          onChange={(e) => updateCategory(item.id, e.target.value)}
                          className="px-3 py-1 rounded-full text-xs font-medium border bg-purple-100 text-purple-700"
                        >
                          {ALL_CATEGORIES.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                        </select>
                      ) : (
                        <span className="px-3 py-1 rounded-full text-xs font-medium border bg-purple-100 text-purple-700">
                          {item.category}
                        </span>
                      )}

                      {view === 'my' && (
                        <button
                          onClick={() => togglePublic(item.id, item.isPublic)}
                          className={`px-3 py-1 rounded-full text-xs font-medium border flex items-center gap-1 ${
                            item.isPublic 
                              ? 'bg-blue-100 text-blue-700 border-blue-300' 
                              : 'bg-gray-100 text-gray-700 border-gray-300'
                          }`}
                          title={item.isPublic ? 'Public - click to make private' : 'Private - click to make public'}
                        >
                          {item.isPublic ? <Globe /> : <Lock />}
                          {item.isPublic ? 'Public' : 'Private'}
                        </button>
                      )}

                      {view === 'public' && item.userName && (
                        <span className="px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600 flex items-center gap-1">
                          <Users />
                          {item.userName}
                        </span>
                      )}
                    </div>

                    <p className="text-gray-800 font-medium mb-1">{item.text}</p>
                    <p className="text-sm text-gray-500">{item.date}</p>

                    {view === 'my' && (
                      <>
                        {editingComment === item.id ? (
                          <div className="mt-3 space-y-2">
                            <textarea
                              value={commentText}
                              onChange={(e) => setCommentText(e.target.value)}
                              placeholder="Add your thoughts..."
                              className="w-full px-3 py-2 border-2 border-purple-300 rounded-lg focus:border-purple-400 focus:outline-none resize-none"
                              rows="3"
                              autoFocus
                            />
                            <div className="flex gap-2">
                              <button 
                                onClick={() => saveComment(item.id)} 
                                className="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium transition-colors"
                              >
                                Save
                              </button>
                              <button 
                                onClick={cancelEditingComment} 
                                className="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition-colors"
                              >
                                Cancel
                              </button>
                            </div>
                          </div>
                        ) : (
                          <>
                            {item.comment && (
                              <div className="mt-2 p-3 bg-gray-50 rounded-lg">
                                <p className="text-sm text-gray-700 italic">{item.comment}</p>
                              </div>
                            )}
                            <button 
                              onClick={() => startEditingComment(item)} 
                              className="mt-2 flex items-center gap-1 text-sm text-purple-600 hover:text-purple-700 font-medium"
                            >
                              <MessageSquare />
                              {item.comment ? 'Edit comment' : 'Add comment'}
                            </button>
                          </>
                        )}
                      </>
                    )}

                    {view === 'public' && item.comment && (
                      <div className="mt-2 p-3 bg-gray-50 rounded-lg">
                        <p className="text-sm text-gray-700 italic">{item.comment}</p>
                      </div>
                    )}
                  </div>

                  {view === 'my' && (
                    <button 
                      onClick={() => deleteItem(item.id)} 
                      className="ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                    >
                      <Trash2 />
                    </button>
                  )}
                </div>
              </div>
            ))
          )}
        </div>

        {/* Stats (only in 'my' view) */}
        {view === 'my' && items.length > 0 && (
          <div className="mt-6 bg-white rounded-2xl shadow-lg p-6">
            <h3 className="font-bold text-gray-800 mb-3">Your Stats</h3>
            <div className="grid grid-cols-2 gap-4">
              <div className="text-center p-4 bg-green-50 rounded-xl">
                <div className="text-3xl font-bold text-green-600">
                  {items.filter(i => i.rating === 'like').length}
                </div>
                <div className="text-sm text-gray-600">Liked</div>
              </div>
              <div className="text-center p-4 bg-red-50 rounded-xl">
                <div className="text-3xl font-bold text-red-600">
                  {items.filter(i => i.rating === 'dislike').length}
                </div>
                <div className="text-sm text-gray-600">Disliked</div>
              </div>
            </div>
          </div>
        )}

      </div>
    </div>
  );
}

ReactDOM.render(<BinaryApp />, document.getElementById('root'));
</script>
</body>
</html>
