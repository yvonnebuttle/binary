<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Binary">
    <title>Binary</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script 
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNjgf2ZqtsUmoXcMq-guhJAPwY9lIUNPkI&libraries=places"
  async defer>
</script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const ThumbsUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>;
        const ThumbsDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></svg>;
        const List = () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>;
        const Trash2 = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
        const Filter = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>;
        const MessageSquare = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>;
// === Google Places category detection ===
async function detectPlaceCategory(text) {
  return new Promise((resolve) => {
    if (!window.google || !window.google.maps) {
      resolve(null); // Google Maps not loaded yet
      return;
    }

    const service = new google.maps.places.AutocompleteService();

    service.getPlacePredictions(
      { input: text, types: ['establishment'] },
      (predictions, status) => {
        if (status !== google.maps.places.PlacesServiceStatus.OK || !predictions?.length) {
          resolve(null);
          return;
        }

        const first = predictions[0];
        const detailsService = new google.maps.places.PlacesService(document.createElement('div'));

        detailsService.getDetails({ placeId: first.place_id, fields: ['types'] }, (place, detailsStatus) => {
          if (detailsStatus === google.maps.places.PlacesServiceStatus.OK && place?.types) {
            if (place.types.includes('cafe') || place.types.includes('coffee_shop')) resolve('Coffee');
            else if (place.types.includes('restaurant')) resolve('Food');
            else if (place.types.includes('bar')) resolve('Beverages');
            else if (place.types.includes('park') || place.types.includes('museum') || place.types.includes('tourist_attraction'))
              resolve('Places');
            else resolve('Other');
          } else {
            resolve(null);
          }
        });
      }
    );
  });
}

       function BinaryApp() {
  const { useState, useEffect } = React;
  const [items, setItems] = useState([]);
  const [inputText, setInputText] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [isLoading, setIsLoading] = useState(true);
  const [editingComment, setEditingComment] = useState(null);
  const [commentText, setCommentText] = useState('');

  // --- Load items and get geolocation ---
  useEffect(() => {
    loadItems();

    // Get user location for proximity scoring
    navigator.geolocation.getCurrentPosition(
      pos => {
        window.userLat = pos.coords.latitude;
        window.userLng = pos.coords.longitude;
      },
      err => console.warn('Location access denied:', err)
    );
  }, []);

  const loadItems = () => {
    try {
      const stored = localStorage.getItem('binaryItems');
      if (stored) setItems(JSON.parse(stored));
    } catch (error) {
      console.error('Error loading items:', error);
    }
    setIsLoading(false);
  };

  const saveItems = (newItems) => {
    try {
      localStorage.setItem('binaryItems', JSON.stringify(newItems));
    } catch (error) {
      console.error('Error saving items:', error);
      alert('Failed to save. Storage might be full.');
    }
  };

  // --- Smart category detection ---
// --- Smart category detection ---
async function detectCategorySmart(text, userLat, userLng) {
  const lowerText = text.toLowerCase();

  // --- 1ï¸âƒ£ Google Places detection ---
  if (window.google && window.google.maps) {
    try {
      const placeCat = await new Promise((resolve) => {
        const service = new google.maps.places.AutocompleteService();
        service.getPlacePredictions(
          { input: text, types: ['establishment'] },
          (predictions, status) => {
            if (status !== google.maps.places.PlacesServiceStatus.OK || !predictions?.length) {
              resolve(null);
              return;
            }
            const first = predictions[0];
            const detailsService = new google.maps.places.PlacesService(document.createElement('div'));
            detailsService.getDetails(
              { placeId: first.place_id, fields: ['types', 'geometry', 'name'] },
              (place, detailsStatus) => {
                if (detailsStatus === google.maps.places.PlacesServiceStatus.OK && place?.types) {
                  let score = 0;

                  // proximity booster
                  if (userLat && userLng && place.geometry?.location) {
                    const dLat = place.geometry.location.lat() - userLat;
                    const dLng = place.geometry.location.lng() - userLng;
                    const dist = Math.sqrt(dLat*dLat + dLng*dLng);
                    if (dist < 0.02) score += 1; // ~2 km
                  }

                  // major city / country booster
                  const majorLocations = ['london','paris','france','new york','tokyo'];
                  if (majorLocations.some(loc => lowerText.includes(loc.toLowerCase()))) score += 1;

                  if (place.types.includes('cafe') || place.types.includes('coffee_shop')) resolve({cat:'Coffee', conf:0.8 + score});
                  else if (place.types.includes('restaurant')) resolve({cat:'Food', conf:0.8 + score});
                  else if (place.types.includes('bar')) resolve({cat:'Beverages', conf:0.8 + score});
                  else if (place.types.includes('park') || place.types.includes('museum') || place.types.includes('tourist_attraction'))
                    resolve({cat:'Places', conf:0.7 + score});
                  else resolve({cat:null, conf:0});
                } else resolve({cat:null, conf:0});
              }
            );
          }
        );
      });

      if (placeCat?.cat && placeCat.conf >= 0.75) return placeCat.cat;
    } catch(err){ console.warn('Google Places detection failed', err);}
  }

  // --- 2ï¸âƒ£ Wikipedia top search for Books / Movies ---
  async function detectWikiCategory(text) {
    try {
      const wikiRes = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(text)}&limit=1&namespace=0&format=json&origin=*`);
      const wikiData = await wikiRes.json();
      const topTitle = wikiData[1]?.[0];
      const snippet = wikiData[2]?.[0];

      if (!topTitle || !snippet) return null;

      const snippetLower = snippet.toLowerCase();
      if (snippetLower.includes('novel') || snippetLower.includes('book') || snippetLower.includes('literature')) return 'Books';
      if (snippetLower.includes('film') || snippetLower.includes('movie') || snippetLower.includes('television')) return 'Movies';
    } catch(err) {
      console.warn('Wikipedia detection failed:', err);
    }
    return null;
  }

  const wikiCat = await detectWikiCategory(text);
  if (wikiCat) return wikiCat;

  // --- 3ï¸âƒ£ Fallback keyword scanning ---
  const categories = {
    'Food': ['restaurant','meal','dinner','lunch','breakfast','food','dish','ate','eating'],
    'Cheese': ['cheese','brie','cheddar','gouda','mozzarella','parmesan'],
    'Coffee': ['coffee','cafe','espresso','latte','cappuccino','americano'],
    'Places': ['visited','trip','travel','vacation','holiday','beach','town','city','park','museum','bar','club','venue'],
    'Dates': ['date','dating','went out','met up'],
    'People': ['person','friend','met','someone','colleague'],
    'Sports': ['tennis','game','played','match','workout','exercise','gym'],
    'Entertainment': ['show','series','music','concert','watched','read'],
      'Books': ['book'],
      'Movies': ['movie', 'film']
  };
  for (const [cat, keywords] of Object.entries(categories)) {
    if (keywords.some(k => lowerText.includes(k))) return cat;
  }

  return 'Other';
}


    // 4ï¸âƒ£ Keyword fallback
    const lower = text.toLowerCase();
    const categories = {
      'Food': ['restaurant','meal','dinner','lunch','breakfast','food','dish','ate','eating'],
      'Cheese': ['cheese','brie','cheddar','gouda','mozzarella','parmesan'],
      'Coffee': ['coffee','cafe','espresso','latte','cappuccino','americano'],
      'Places': ['visited','trip','travel','vacation','holiday','beach','town','city','park','museum','bar','club','venue'],
      'Dates': ['date','dating','went out','met up'],
      'People': ['person','friend','met','someone','colleague'],
      'Sports': ['tennis','game','played','match','workout','exercise','gym'],
      'Entertainment': ['movie','show','series','book','music','concert','watched','read'],
    };
    for (const [cat, keywords] of Object.entries(categories)) {
      if (keywords.some(k => lower.includes(k))) return cat;
    }

    return 'Other';
  }

  // --- Add item ---
  const addItem = async (rating) => {
    if (!inputText.trim()) return;
    try {
      const category = await detectCategorySmart(inputText, window.userLat, window.userLng);
      const newItem = {
        id: Date.now().toString(),
        text: inputText.trim(),
        rating,
        category,
        timestamp: Date.now(),
        date: new Date().toLocaleDateString()
      };
      const newItems = [newItem, ...items];
      setItems(newItems);
      saveItems(newItems);
      setInputText('');
    } catch(err) {
      console.error('Error adding item:', err);
      alert('Failed to add item. Try again.');
    }
  };
  // --- Update category manually ---
  const updateCategory = (id, newCat) => {
    const newItems = items.map(item => item.id === id ? {...item, category: newCat} : item);
    setItems(newItems);
    saveItems(newItems);
          };
            const deleteItem = (id) => {
            const newItems = items.filter(item => item.id !== id);
            setItems(newItems);
            saveItems(newItems);

          const startEditingComment = (item) => {
            setEditingComment(item.id);
            setCommentText(item.comment || '');
          };

          const saveComment = (id) => {
            const newItems = items.map(item => 
              item.id === id ? { ...item, comment: commentText.trim() } : item
            );
            setItems(newItems);
            saveItems(newItems);
            setEditingComment(null);
            setCommentText('');
          };

          const cancelEditingComment = () => {
            setEditingComment(null);
            setCommentText('');
          };

          const categories = ['All', ...new Set(items.map(item => item.category))].sort();
          
          const filteredItems = selectedCategory === 'All' 
            ? items 
            : items.filter(item => item.category === selectedCategory);

          const getRatingEmoji = (rating) => {
            return rating === 'like' ? 'ðŸ‘' : 'ðŸ‘Ž';
          };

          const getRatingColor = (rating) => {
            return rating === 'like' ? 'bg-green-100 text-green-800 border-green-300' : 'bg-red-100 text-red-800 border-red-300';
          };

          if (isLoading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 flex items-center justify-center">
                <div className="text-gray-600">Loading...</div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50 pb-6">
              <div className="max-w-2xl mx-auto px-4 py-6">
                <div className="text-center mb-6">
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">Binary</h1>
                  <p className="text-gray-600">Yes/no, that's all</p>
                </div>

                <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                  <div className="flex items-center gap-2 mb-4">
                    <div className="relative flex-1">
                      <input
                        type="text"
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                        placeholder="What did you experience?"
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none"
                        onKeyPress={(e) => e.key === 'Enter' && inputText.trim() && document.getElementById('like-btn').focus()}
                      />
                      <div className="absolute right-3 top-3.5 text-gray-400"><Mic /></div>
                    </div>
                  </div>
                  
                  <div className="text-xs text-gray-500 mb-3 text-center">
                    Tap the microphone icon on your keyboard to use voice input
                  </div>

                  <div className="flex gap-3">
                    <button
                      id="like-btn"
                      onClick={() => addItem('like')}
                      disabled={!inputText.trim()}
                      className="flex-1 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-semibold py-3 px-6 rounded-xl flex items-center justify-center gap-2 transition-colors"
                    >
                      <ThumbsUp />
                      Like
                    </button>
                    <button
                      onClick={() => addItem('dislike')}
                      disabled={!inputText.trim()}
                      className="flex-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-300 text-white font-semibold py-3 px-6 rounded-xl flex items-center justify-center gap-2 transition-colors"
                    >
                      <ThumbsDown />
                      Dislike
                    </button>
                  </div>
                </div>

                {items.length > 0 && (
                  <div className="bg-white rounded-2xl shadow-lg p-4 mb-6">
                    <div className="flex items-center gap-2 mb-3">
                      <Filter />
                      <span className="font-semibold text-gray-700">Filter by category:</span>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {categories.map(cat => (
                        <button
                          key={cat}
                          onClick={() => setSelectedCategory(cat)}
                          className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                            selectedCategory === cat
                              ? 'bg-purple-500 text-white'
                              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                          }`}
                        >
                          {cat}
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                <div className="space-y-3">
                  {filteredItems.length === 0 ? (
                    <div className="bg-white rounded-2xl shadow-lg p-12 text-center">
                      <div className="flex justify-center mb-4"><List /></div>
                      <p className="text-gray-500">
                        {items.length === 0 
                          ? "No ratings yet. Start by rating your first experience!"
                          : "No items in this category yet."}
                      </p>
                    </div>
                  ) : (
                    filteredItems.map(item => (
                      <div
                        key={item.id}
                        className="bg-white rounded-xl shadow-md p-4 hover:shadow-lg transition-shadow"
                      >
                        <div className="flex items-start justify-between">
                          <div className="flex-1">
                            <div className="flex items-center gap-2 mb-1">
                              <span className={`px-3 py-1 rounded-full text-sm font-semibold border-2 ${getRatingColor(item.rating)}`}>
                                {getRatingEmoji(item.rating)} {item.rating === 'like' ? 'Liked' : 'Disliked'}
                              </span>
                             <select
  value={item.category}
  onChange={(e) => updateCategory(item.id, e.target.value)}
  className="px-3 py-1 rounded-full text-xs font-medium border bg-purple-100 text-purple-700"
>
  {categories.filter(c => c !== 'All').map(c => (
    <option key={c} value={c}>{c}</option>
  ))}
</select>
                            </div>
                            <p className="text-gray-800 font-medium mb-1">{item.text}</p>
                            <p className="text-sm text-gray-500">{item.date}</p>
                            
                            {editingComment === item.id ? (
                              <div className="mt-3 space-y-2">
                                <textarea
                                  value={commentText}
                                  onChange={(e) => setCommentText(e.target.value)}
                                  placeholder="Add your thoughts..."
                                  className="w-full px-3 py-2 border-2 border-purple-300 rounded-lg focus:border-purple-400 focus:outline-none resize-none"
                                  rows="3"
                                  autoFocus
                                />
                                <div className="flex gap-2">
                                  <button
                                    onClick={() => saveComment(item.id)}
                                    className="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium transition-colors"
                                  >
                                    Save
                                  </button>
                                  <button
                                    onClick={cancelEditingComment}
                                    className="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition-colors"
                                  >
                                    Cancel
                                  </button>
                                </div>
                              </div>
                            ) : (
                              <>
                                {item.comment && (
                                  <div className="mt-2 p-3 bg-gray-50 rounded-lg">
                                    <p className="text-sm text-gray-700 italic">{item.comment}</p>
                                  </div>
                                )}
                                <button
                                  onClick={() => startEditingComment(item)}
                                  className="mt-2 flex items-center gap-1 text-sm text-purple-600 hover:text-purple-700 font-medium"
                                >
                                  <MessageSquare />
                                  {item.comment ? 'Edit comment' : 'Add comment'}
                                </button>
                              </>
                            )}
                          </div>
                          <button
                            onClick={() => deleteItem(item.id)}
                            className="ml-4 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                          >
                            <Trash2 />
                          </button>
                        </div>
                      </div>
                    ))
                  )}
                </div>

                {items.length > 0 && (
                  <div className="mt-6 bg-white rounded-2xl shadow-lg p-6">
                    <h3 className="font-bold text-gray-800 mb-3">Your Stats</h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="text-center p-4 bg-green-50 rounded-xl">
                        <div className="text-3xl font-bold text-green-600">
                          {items.filter(i => i.rating === 'like').length}
                        </div>
                        <div className="text-sm text-gray-600">Liked</div>
                      </div>
                      <div className="text-center p-4 bg-red-50 rounded-xl">
                        <div className="text-3xl font-bold text-red-600">
                          {items.filter(i => i.rating === 'dislike').length}
                        </div>
                        <div className="text-sm text-gray-600">Disliked</div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }

        ReactDOM.render(<BinaryApp />, document.getElementById('root'));
    </script>
</body>
</html>
